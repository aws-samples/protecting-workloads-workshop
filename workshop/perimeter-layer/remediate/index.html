



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="This workshop shows how you can protect a web site using AWS Security Services">
      
      
        <link rel="canonical" href="https://protecting-workloads.awssecworkshops.com/workshop/perimeter-layer/remediate/">
      
      
        <meta name="author" content="aws-security-workshops@amazon.com">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/aws-favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.2.0">
    
    
      
        <title>Remediate Phase - Protecting Workloads on AWS from the Instance to the Edge</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.750b69bd.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../stylesheets/custom.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#mitigating-common-web-application-attack-vectors-using-aws-waf-remediate-phase" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
  Copyright (c) 2016-2018 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

    <!-- Top-level navigation -->
    <nav class="md-header-nav md-grid">
      <div class="md-flex">
  
        <!-- Link to home -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <a href="https://aws.amazon.com/"
              title="Amazon Web Services"
              class="md-header-nav__button md-logo">
            
              <img src="../../../assets/images/aws_smile_logo.png" width="40" height="24" />
            
          </a>
        </div>
  
        <!-- Button to toggle drawer -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <label class="md-icon md-icon--menu md-header-nav__button"
              for="__drawer"></label>
        </div>
  
        <!-- Header title -->
        <div class="md-flex__cell md-flex__cell--stretch">
          <div class="md-flex__ellipsis md-header-nav__title"
              data-md-component="title">
            
              
                <span class="md-header-nav__topic">
                  Protecting Workloads on AWS from the Instance to the Edge
                </span>
                <span class="md-header-nav__topic">
                  Remediate Phase
                </span>
              
            
          </div>
        </div>
        
        
        <!-- Button to open search dialogue -->
        <!--
        <div class="md-flex__cell md-flex__cell--shrink">
          
            
              <label class="md-icon md-icon--search md-header-nav__button"
                  for="__search"></label>
  
              
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
            
          
        </div>

         -->
         
         <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-flex__ellipsis md-header-nav__lang">
                <div>
                    <button onclick="window.location.href = 'https://awssecworkshops.com/';" class="md-lang-dropbtn fa fa-home"></button>
                </div>
            </div>
        </div>
  
        <!-- Repository containing source -->
        
          <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-header-nav__source">
              


  

<a href="https://github.com/aws-samples/protecting-workloads-workshop/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    aws-samples/protecting-workloads-workshop
  </div>
</a>
            </div>
          </div>
        
      </div>
    </nav>
  </header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../" title="Workshop" class="md-tabs__link md-tabs__link--active">
          Workshop
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!--
  Copyright (c) 2016-2019 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Main navigation -->
<nav class="md-nav md-nav--primary" data-md-level="0">

  <!-- Site title -->
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://protecting-workloads.awssecworkshops.com/"
        title="Protecting Workloads on AWS from the Instance to the Edge" class="md-nav__button md-logo">
      
        <img src="../../../assets/images/aws_smile_logo.png" width="48" height="48" />
      
    </a>
    
  </label>

  <!-- Repository containing source -->
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/aws-samples/protecting-workloads-workshop/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    aws-samples/protecting-workloads-workshop
  </div>
</a>
    </div>
  

  <!-- Render item list -->
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Workshop
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Workshop
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../" title="Scenario" class="md-nav__link">
      Scenario
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../build/" title="Build Phase" class="md-nav__link">
      Build Phase
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4" checked>
    
    <label class="md-nav__link" for="nav-2-4">
      Perimeter Layer
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        Perimeter Layer
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../assess/" title="Assess Phase" class="md-nav__link">
      Assess Phase
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Remediate Phase
      </label>
    
    <a href="./" title="Remediate Phase" class="md-nav__link md-nav__link--active">
      Remediate Phase
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#identify-the-waf-acl-for-your-site" title="Identify the WAF ACL for your Site" class="md-nav__link">
    Identify the WAF ACL for your Site
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-waf-rule-design-and-considerations" title="AWS WAF Rule Design and Considerations" class="md-nav__link">
    AWS WAF Rule Design and Considerations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basics" title="Basics" class="md-nav__link">
    Basics
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-waf-works" title="How WAF Works" class="md-nav__link">
    How WAF Works
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rule-design-considerations" title="Rule Design Considerations:" class="md-nav__link">
    Rule Design Considerations:
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sample-rule-purpose" title="Sample Rule purpose:" class="md-nav__link">
    Sample Rule purpose:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-request-components" title="HTTP request components:" class="md-nav__link">
    HTTP request components:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-the-purpose-of-the-rule-using-boolean-logic" title="Define the purpose of the rule using Boolean logic:" class="md-nav__link">
    Define the purpose of the rule using Boolean logic:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-rule-statement-to-implement" title="Sample Rule - Statement to implement:" class="md-nav__link">
    Sample Rule - Statement to implement:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relevant-transformations" title="Relevant transformations:" class="md-nav__link">
    Relevant transformations:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rules-to-implement" title="Rules to implement:" class="md-nav__link">
    Rules to implement:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#console-walkthrough-creating-a-rule" title="Console Walkthrough - Creating a Rule" class="md-nav__link">
    Console Walkthrough - Creating a Rule
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#waf-rule-creation-and-solutions" title="WAF Rule Creation and Solutions" class="md-nav__link">
    WAF Rule Creation and Solutions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-sql-injection-cross-site-scripting-mitigation" title="1. SQL Injection &amp; Cross Site Scripting Mitigation" class="md-nav__link">
    1. SQL Injection &amp; Cross Site Scripting Mitigation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-mitigate-file-inclusion-path-traversal" title="2. Mitigate File Inclusion &amp; Path Traversal" class="md-nav__link">
    2. Mitigate File Inclusion &amp; Path Traversal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-enforce-request-hygiene" title="3. Enforce Request Hygiene" class="md-nav__link">
    3. Enforce Request Hygiene
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-limit-attack-footprint-optional" title="4. Limit Attack Footprint (Optional)" class="md-nav__link">
    4. Limit Attack Footprint (Optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-detect-mitigate-anomalies-optional" title="5. Detect &amp; Mitigate Anomalies (Optional)" class="md-nav__link">
    5. Detect &amp; Mitigate Anomalies (Optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-reputation-lists-nuisance-requests-optional" title="6. Reputation Lists, Nuisance Requests (Optional)" class="md-nav__link">
    6. Reputation Lists, Nuisance Requests (Optional)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../verify/" title="Verify Phase" class="md-nav__link">
      Verify Phase
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      Host Layer
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        Host Layer
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../host-layer/assess/" title="Assess Phase" class="md-nav__link">
      Assess Phase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../host-layer/remediate/" title="Remediate Phase" class="md-nav__link">
      Remediate Phase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../host-layer/verify/" title="Verify Phase" class="md-nav__link">
      Verify Phase
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cleanup/" title="Cleanup" class="md-nav__link">
      Cleanup
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#identify-the-waf-acl-for-your-site" title="Identify the WAF ACL for your Site" class="md-nav__link">
    Identify the WAF ACL for your Site
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-waf-rule-design-and-considerations" title="AWS WAF Rule Design and Considerations" class="md-nav__link">
    AWS WAF Rule Design and Considerations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basics" title="Basics" class="md-nav__link">
    Basics
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-waf-works" title="How WAF Works" class="md-nav__link">
    How WAF Works
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rule-design-considerations" title="Rule Design Considerations:" class="md-nav__link">
    Rule Design Considerations:
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sample-rule-purpose" title="Sample Rule purpose:" class="md-nav__link">
    Sample Rule purpose:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-request-components" title="HTTP request components:" class="md-nav__link">
    HTTP request components:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-the-purpose-of-the-rule-using-boolean-logic" title="Define the purpose of the rule using Boolean logic:" class="md-nav__link">
    Define the purpose of the rule using Boolean logic:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-rule-statement-to-implement" title="Sample Rule - Statement to implement:" class="md-nav__link">
    Sample Rule - Statement to implement:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relevant-transformations" title="Relevant transformations:" class="md-nav__link">
    Relevant transformations:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rules-to-implement" title="Rules to implement:" class="md-nav__link">
    Rules to implement:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#console-walkthrough-creating-a-rule" title="Console Walkthrough - Creating a Rule" class="md-nav__link">
    Console Walkthrough - Creating a Rule
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#waf-rule-creation-and-solutions" title="WAF Rule Creation and Solutions" class="md-nav__link">
    WAF Rule Creation and Solutions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-sql-injection-cross-site-scripting-mitigation" title="1. SQL Injection &amp; Cross Site Scripting Mitigation" class="md-nav__link">
    1. SQL Injection &amp; Cross Site Scripting Mitigation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-mitigate-file-inclusion-path-traversal" title="2. Mitigate File Inclusion &amp; Path Traversal" class="md-nav__link">
    2. Mitigate File Inclusion &amp; Path Traversal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-enforce-request-hygiene" title="3. Enforce Request Hygiene" class="md-nav__link">
    3. Enforce Request Hygiene
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-limit-attack-footprint-optional" title="4. Limit Attack Footprint (Optional)" class="md-nav__link">
    4. Limit Attack Footprint (Optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-detect-mitigate-anomalies-optional" title="5. Detect &amp; Mitigate Anomalies (Optional)" class="md-nav__link">
    5. Detect &amp; Mitigate Anomalies (Optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-reputation-lists-nuisance-requests-optional" title="6. Reputation Lists, Nuisance Requests (Optional)" class="md-nav__link">
    6. Reputation Lists, Nuisance Requests (Optional)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws-samples/protecting-workloads-workshop/edit/master/docs/workshop/perimeter-layer/remediate.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="mitigating-common-web-application-attack-vectors-using-aws-waf-remediate-phase">Mitigating Common Web Application Attack Vectors Using AWS WAF - Remediate Phase</h1>
<p>In the previous Build Phase, you identified several vulnerabilities in your web application.
You are now going to design and implement an AWS WAF ruleset to help mitigate these vulnerabilities. In this section you will do the following tasks:</p>
<ol>
<li>Identify the WAF ACL for your site</li>
<li>AWS WAF Rule design and considerations</li>
<li>Console Walkthrough - Creating a Rule</li>
<li>WAF Rule Creation and Solutions</li>
</ol>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p><p style="font-size:14px;">
  Please ensure you are <strong>using the improved AWS WAF console and API experience</strong> for this workshop.
</p></p>
</div>
<h2 id="identify-the-waf-acl-for-your-site">Identify the WAF ACL for your Site</h2>
<ol>
<li>
<p>If needed, go to <a href="https://console.aws.amazon.com/console/home" target="_blank">https://console.aws.amazon.com/console/home</a>. You will be redirected to the AWS Management Console dashboard on successful login:
<img alt="Console Home" src="../images/console-home.png" />
Make sure you select the appropriate AWS Region when working in the AWS Management Console (top right corner, on the menu bar).</p>
</li>
<li>
<p>From the Management Console dashboard, navigate to the AWS WAF &amp; Shield service console. You can do that several ways:</p>
<ul>
<li>Type “waf” in the AWS services panel search box and select the resulting option</li>
<li>Expand the Services drop down menu (top left on the menu bar) and choose WAF &amp; Shield</li>
<li>Expand the All services area of the AWS services panel and choose WAF &amp; Shield
Once selected, you will be redirected to the AWS WAF &amp; AWS Shield service console. You may see an initial landing page at first. Choose Go to AWS WAF:</li>
</ul>
</li>
</ol>
<p><img alt="WAF Home" src="../images/waf-home.png" />
3.  In the side bar menu on the left, pick the Web ACLs option under the AWS WAF heading. If the list of Web ACLs appears empty select the correct AWS Region as indicated on your credentials card in the Filter dropdown <strong>IN THE Web ACLs area of the window</strong>. If you are sharing the same account with other participants you can identify your WAF ACL by the Id in the stack outputs in the region where the stack was launched.</p>
<p><img alt="WAF ACL Home" src="../images/waf-acl-home.png" />
4. Click on the WAF Web ACL Name to select the existing Web ACL. Once the detail pane is loaded on the left of your screen, you will see three tabs: Requests, Rules, and Logging. Toggle to Rules:</p>
<p><img alt="WAF ACL Rules" src="../images/waf-acl-rules.png" />
Validate that you are able to see a pre-existing rule, configured to block requests, and that your Web ACL is associated with an Application load balancer resource. You can drill down further into the properties of the existing rule, by selecting the rule name and clicking <strong>Edit</strong>. This rule references IP sets for the loopback/localhost IP addresses (127.0.0.0/8, ::1/128).</p>
<div class="admonition info">
<p class="admonition-title">Viewing and Logging Requests</p>
<p><em>In the <strong>Overview</strong> tab for your Web ACL, you can view a <a href="https://docs.aws.amazon.com/waf/latest/developerguide/web-acl-testing.html#web-acl-testing-view-sample" target="_blank">sample of the requests</a> that have been inspected by the WAF. For each sampled request, you can view detailed data about the request, such as the originating IP address and the headers included in the request. You also can view which rule the request matched, and whether the rule is configured to allow or block requests. You can refer to the sampled requests throughout this exercise to monitor activity and look for suspicious activity. Although not used in this workshop, in the <strong>Logging and metrics</strong> tab, <a href="https://docs.aws.amazon.com/waf/latest/developerguide/logging.html" target="_blank">you can enable full logging</a> to get detailed information about traffic that is analyzed by your web ACL.</em></p>
</div>
<h2 id="aws-waf-rule-design-and-considerations">AWS WAF Rule Design and Considerations</h2>
<h3 id="basics">Basics</h3>
<p>You use AWS WAF to control how an Amazon CloudFront distribution, an Amazon API Gateway API, or an Application Load Balancer responds to web requests.</p>
<p><strong>Web ACLs</strong> – You use a web access control list (ACL) to protect a set of AWS resources. You create a web ACL and define its protection strategy by adding rules. Rules define criteria for inspecting web requests and specify how to handle requests that match the criteria. You set a default action for the web ACL that indicates whether to block or allow through those requests that pass the rules inspections.</p>
<p><strong>Rules</strong> – Each rule contains a statement that defines the inspection criteria, and an action to take if a web request meets the criteria. When a web request meets the criteria, that's a match. You can use rules to block matching requests or to allow matching requests through. You can also use rules just to count matching requests.</p>
<p><strong>Rules groups</strong> – You can use rules individually or in reusable rule groups. AWS Managed Rules and AWS Marketplace sellers provide managed rule groups for your use. You can also define your own rule groups.</p>
<p>Rule statements are the part of a rule that tells AWS WAF how to inspect a web request. When AWS WAF finds the inspection criteria in a web request, we say that the web request matches the statement. Every rule statement specifies what to look for and how, according to the statement type.</p>
<p>Every rule in AWS WAF has a single top-level rule statement, which can contain other statements. Rule statements can be very simple. For example, you could have a statement that provides just a set of originating countries to check your web requests for. Rule statements can also be very complex. For example, you could have a statement that combines many other statements with logical AND, OR, and NOT statements.</p>
<h4 id="how-waf-works">How WAF Works</h4>
<p><img alt="How WAF Works" src="../images/how-waf-works.png" /></p>
<p>After you create your web ACL, you can associate it with one or more AWS resources. The resource types that you can protect using AWS WAF web ACLs are Amazon CloudFront distributions, Amazon API Gateway APIs, and Application Load Balancers.</p>
<div class="admonition info">
<p class="admonition-title">Note About This Section</p>
<p><strong>In order to illustrate the process of creating WAF rules, we will walk through the creation of the first rule in your WAF ACL.</strong> The complete list of threats and solutions is available in the <a href="./#waf-rule-creation-and-solutions">WAF Rule Creation and Solutions</a> section.</p>
</div>
<h3 id="rule-design-considerations">Rule Design Considerations:</h3>
<p>Use the following guiding questions when planning WAF rules:</p>
<ol>
<li>What is the intended purpose of the rule?</li>
<li>What HTTP request components apply to the purpose of the rule?</li>
<li>Do you already have rules or rule groups targeting those request components that you can expand? Is that desirable?</li>
<li>How can you define the purpose of the rule in a Boolean logic expression?</li>
<li>Will the rule require nested statements under logical AND or OR rule statements?</li>
<li>Are any transformations relevant to my input content type?</li>
</ol>
<h4 id="sample-rule-purpose">Sample Rule purpose:</h4>
<ul>
<li><strong>Detect SQL Injection in query string, use ‘block’ action in Web ACL</strong></li>
</ul>
<h4 id="http-request-components">HTTP request components:</h4>
<ul>
<li><strong>Request Method</strong> – form input typically gets submitted using a GET HTTP request method</li>
<li><strong>Query String</strong> – the SQL injection attempt is located in the query string </li>
</ul>
<h4 id="define-the-purpose-of-the-rule-using-boolean-logic">Define the purpose of the rule using Boolean logic:</h4>
<ul>
<li>If <strong>Query String contains suspected SQL Injection</strong> then <strong>block</strong></li>
</ul>
<h4 id="sample-rule-statement-to-implement">Sample Rule - Statement to implement:</h4>
<ul>
<li><strong>Contains SQL injection attacks Match type</strong> targeting the request <strong>Query string</strong></li>
</ul>
<h4 id="relevant-transformations">Relevant transformations:</h4>
<ul>
<li><strong>Contains SQL injection attacks Match type</strong> query string is URL encoded, so we will apply the <strong>URL_DECODE</strong> transformation.</li>
</ul>
<h4 id="rules-to-implement">Rules to implement:</h4>
<ul>
<li>Rule with 1 predicate Contains SQL injection attacks Match type</li>
</ul>
<h2 id="console-walkthrough-creating-a-rule">Console Walkthrough - Creating a Rule</h2>
<ol>
<li>
<p>In the AWS WAF console, create a SQL injection rule by clicking the Web ACL, <strong>Add rules</strong>, <strong>Add my own rules and rule groups</strong></p>
</li>
<li>
<p>Click on <strong>Rule builder</strong>, provide <strong>matchSQLi</strong> for the <strong>Name</strong> and keep <strong>Regular rule</strong> for <strong>Type</strong>:</p>
</li>
</ol>
<p><img alt="WAF Rule 1" src="../images/waf-add-rule-1.png" />
3.  For <strong>If a request</strong> select <strong>matches the statement</strong>. Under <strong>Statement</strong>, for <strong>Insepect</strong> select <strong>Query string</strong>, for <strong>Match type</strong> select <strong>Contains SQL injection attacks</strong>, for <strong>Text transformation</strong> select <strong>URL decode</strong> and for <strong>Action</strong> select <strong>Block</strong>.</p>
<p><img alt="WAF Rule 2" src="../images/waf-add-rule-2.png" />
4.  Click on <strong>Add Rule</strong> and then click <strong>Save</strong></p>
<ol>
<li>View the <strong>matchSQLi</strong> rule in the <strong>Rule visual editor</strong> to confirm it is correct.</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Additional Resources</p>
<p>For a more comprehensive discussion of common vulnerabilities for web applications, as well as how to mitigate them using AWS WAF, and other AWS services, please refer to the <a href="https://d0.awsstatic.com/whitepapers/Security/aws-waf-owasp.pdf" target="_blank">Use AWS WAF to Mitigate OWASP’s Top 10 Web Application Vulnerabilities whitepaper</a>.</p>
</div>
<h2 id="waf-rule-creation-and-solutions">WAF Rule Creation and Solutions</h2>
<p>In this phase, we will have a set of 6 exercises walking you through the process of building a basic mitigation rule set for common vulnerabilities. We will build these rules from scratch, so you can gain familiarity with the AWS WAF programming model and you can then write rules specific to your applications. </p>
<div class="admonition info">
<p class="admonition-title">Note About Exercise Solutions</p>
<p>For the exercises below, you will find the high level description and solution configuration for your web ACL. You can test your ACL ruleset at any time using the Red Team Host. For AWS sponsored event, you can also view test results on the <a href="http://waflabdash.awssecworkshops.com/" target="_blank">WAF Lab Dashboard</a>.</p>
</div>
<h3 id="1-sql-injection-cross-site-scripting-mitigation">1. SQL Injection &amp; Cross Site Scripting Mitigation</h3>
<p>Use the SQL injection, cross-site scripting, as well as string and regex matching to build rules that mitigate injection attacks and cross site scripting attacks.</p>
<p>Consider the following:</p>
<ul>
<li>How does your web application accept end-user input (whether directly or indirectly). Which HTTP request components does that input get inserted into?</li>
<li>What kind of content encoding considerations do you need to factor in for the input format?</li>
<li>What considerations do you need to account for in regards to false positives? For example, does your application legitimately need to accept SQL statements as input?</li>
</ul>
<p>How do the requirements derived from the above questions affect your solution?</p>
<details class="info"><summary>SQL Injection Solution</summary><ol>
<li>Update the <strong>matchSQLi</strong> rule with 2 additional statements<ol>
<li>Select the <strong>matchSQLi</strong> rule and click <strong>Edit</strong> (<em>You should have created this rule in <a href="./#console-walkthrough-creating-a-rule">the walk through above</a></em>)</li>
<li>Change <strong>If a request</strong> to <strong>matches at least one of the statements (OR)</strong></li>
<li>Click <strong>Add another statement</strong>: body, contains sql injection attacks, html entity decode and URL decode</li>
<li>Click <strong>Add another statement</strong>: header, cookie (<em>type manually</em>), contains sql injection attacks, url decode</li>
</ol>
</li>
<li>View the existing matchSQLi rule to confirm additional condtions</li>
<li>Re-run the WAF test script (runscanner) from your red team host to confirm requests are blocked</li>
</ol>
</details>
<div class="admonition info">
<p class="admonition-title">Rule JSON editor</p>
<p>Thus far you have used the Visual Rule Editor to create WAF Rules but every web ACL also has a JSON format representation. In there, you see these special types of rule statements. For rules of any complexity, managing your web ACL using the JSON editor is the easiest way to go. You can retrieve the complete configuration for a web ACL in JSON format, modify it as you need, and then provide it through the console, API, or CLI. AWS WAF supports nesting of rule statements. To combine rule statement results, you nest the statements under logical AND or OR rule statements. The visual editor on the console supports one level of rule statement nesting, which works for many needs. To nest more levels, you can edit the JSON representation of the rule on the console.</p>
</div>
<details class="info"><summary>Cross Site Scripting Solution</summary><ol>
<li>Create a new rule named <strong>matchXSS</strong> and for <strong>If a request</strong> choose <strong>matches at least one of the statements (OR)</strong>. Add statements:<ol>
<li>all query parameters, contains xss injection attacks, url decode</li>
<li>body, contains xss injection attacks, html enity decode and url decode</li>
<li>header, cookie (<em>type manually</em>), contains xss injection attacks, url decode</li>
<li>Click on <strong>Add Rule</strong> and then click <strong>Save</strong></li>
</ol>
</li>
<li><strong>Edit</strong> the rule, click the <strong>Rule JSON editor</strong> and note the structure and syntax of the rule logic. </li>
<li>
<p>Add an exception statement for the XSS rule to allow access to <em>/reportBuilder/Editor.aspx</em>. <em>Note that we are using the JSON editor here due to the nested logic required for the exception.</em></p>
<ol>
<li>After reviewing it, clear the existing editor content for the matchXSS rule and paste the following JSON</li>
</ol>
<p><details><summary>Nested Statement with XSS Exception Solution</summary>
<p></p>
<div class="codehilite"><pre><span></span>{
    &quot;Name&quot;: &quot;matchXSS&quot;,
    &quot;Priority&quot;: 2,
    &quot;Action&quot;: {
        &quot;Block&quot;: {}
    },
    &quot;VisibilityConfig&quot;: {
        &quot;SampledRequestsEnabled&quot;: true,
        &quot;CloudWatchMetricsEnabled&quot;: true,
        &quot;MetricName&quot;: &quot;matchXSS&quot;
    },
    &quot;Statement&quot;: {
        &quot;AndStatement&quot;: {
            &quot;Statements&quot;: [{
                    &quot;NotStatement&quot;: {
                        &quot;Statement&quot;: {
                            &quot;ByteMatchStatement&quot;: {
                                &quot;SearchString&quot;: &quot;/reportBuilder/Editor.aspx&quot;,
                                &quot;FieldToMatch&quot;: {
                                    &quot;UriPath&quot;: {}
                                },
                                &quot;TextTransformations&quot;: [{
                                    &quot;Priority&quot;: 0,
                                    &quot;Type&quot;: &quot;NONE&quot;
                                }],
                                &quot;PositionalConstraint&quot;: &quot;STARTS_WITH&quot;
                            }
                        }
                    }
                },
                {
                    &quot;OrStatement&quot;: {
                        &quot;Statements&quot;: [{
                                &quot;XssMatchStatement&quot;: {
                                    &quot;FieldToMatch&quot;: {
                                        &quot;QueryString&quot;: {}
                                    },
                                    &quot;TextTransformations&quot;: [{
                                        &quot;Priority&quot;: 0,
                                        &quot;Type&quot;: &quot;URL_DECODE&quot;
                                    }]
                                }
                            },
                            {
                                &quot;XssMatchStatement&quot;: {
                                    &quot;FieldToMatch&quot;: {
                                        &quot;Body&quot;: {}
                                    },
                                    &quot;TextTransformations&quot;: [{
                                            &quot;Priority&quot;: 0,
                                            &quot;Type&quot;: &quot;HTML_ENTITY_DECODE&quot;
                                        },
                                        {
                                            &quot;Priority&quot;: 1,
                                            &quot;Type&quot;: &quot;URL_DECODE&quot;
                                        }
                                    ]
                                }
                            },
                            {
                                &quot;XssMatchStatement&quot;: {
                                    &quot;FieldToMatch&quot;: {
                                        &quot;SingleHeader&quot;: {
                                            &quot;Name&quot;: &quot;cookie&quot;
                                        }
                                    },
                                    &quot;TextTransformations&quot;: [{
                                        &quot;Priority&quot;: 0,
                                        &quot;Type&quot;: &quot;URL_DECODE&quot;
                                    }]
                                }
                            }
                        ]
                    }
                }
            ]
        }
    }
}
</pre></div>


<p></p>
</details></p>
</li>
<li>
<p>Click <strong>Save rule</strong></p>
</li>
<li>Re-run the WAF test script (runscanner) from your red team host to confirm requests are blocked</li>
</ol>
</details>
<h3 id="2-mitigate-file-inclusion-path-traversal">2. Mitigate File Inclusion &amp; Path Traversal</h3>
<p>Use the string and regex matching to build rules that block specific patterns indicative of unwanted path traversal or file inclusion.</p>
<p>Consider the following:</p>
<ul>
<li>Can end users browse the directory structure of your web folders? Do you have directory indexes enabled?</li>
<li>Is your application (or any dependency components) use input parameters in filesystem or remote URL references? </li>
<li>Do you adequately lock down access so input paths cannot be manipulated?</li>
<li>What considerations do you need to account for in regards to false positives (directory traversal signature patterns)?  </li>
</ul>
<p>Build rules that ensure the relevant HTTP request components used for input into paths do not contain known path traversal patterns.</p>
<details class="info"><summary>Solution</summary><ol>
<li>Create a new rule named <strong>matchTraversal</strong> and for <strong>If a request</strong> choose <strong>matches at least one of the statements (OR)</strong>. Add statements:<ol>
<li>uri_path, starts with string, <em>/include</em>, url_decode </li>
<li>query_string, contains string, <em>../</em>, url_decode</li>
<li>query_string, contains string, <em>://</em>, url_decode</li>
<li>Click on <strong>Add Rule</strong> and then click <strong>Save</strong></li>
</ol>
</li>
<li>Re-run the WAF test script (runscanner) from your red team host to confirm requests are blocked</li>
</ol>
</details>
<h3 id="3-enforce-request-hygiene">3. Enforce Request Hygiene</h3>
<p>Use the string and regex matching, size constraints and IP address matching to build rules that block non-conforming or low value HTTP requests.</p>
<p>Consider the following:</p>
<p>•   Are there limits to the size of the various HTTP request components relevant to your web application? For example, does your application ever use URIs that are longer than 100 characters in size?</p>
<p>•   Are there specific HTTP request components without which your application cannot operate effectively (e.g. CSRF token header, authorization header, referrer header)?</p>
<p>Build rules that ensure the requests your application ends up processing are valid, conforming and valuable.</p>
<details class="info"><summary>Solution</summary><ol>
<li>
<p>In the left pane, choose <strong>Regex pattern sets</strong>, <strong>Create regex pattern set</strong> </p>
<ol>
<li><strong>Regex pattern set name</strong> <em>csrf</em>, <strong>Regular expressions</strong> <em>^[0-9a-f]{40}$</em><ol>
<li>The Regex pattern above is a simple example that matahes the string length (40) and characters (0-9 or a-f). Copy the Regex pattern set ID into a scratch file to refer to it later.</li>
<li>Note your AWS account Id (<em>in CloudFormation Stack Outputs</em>) and region and add them to the scratch file.</li>
</ol>
</li>
</ol>
</li>
<li>
<p>Create a new rule and choose <strong>Rule JSON editor</strong></p>
<ol>
<li>
<p>Delete any existing text and paste the following JSON below. Review the statements in the JSON</p>
</li>
<li>
<p><strong>update the region, AWS account Id and Regex pattern ID</strong> with the one created in the previous step</p>
</li>
</ol>
<p><details><summary>Nested Statement with Request Hygiene Solution</summary>
<p></p>
<div class="codehilite"><pre><span></span>{
    &quot;Name&quot;: &quot;matchCSRF&quot;,
    &quot;Priority&quot;: 3,
    &quot;Action&quot;: {
        &quot;Block&quot;: {}
    },
    &quot;VisibilityConfig&quot;: {
        &quot;SampledRequestsEnabled&quot;: true,
        &quot;CloudWatchMetricsEnabled&quot;: true,
        &quot;MetricName&quot;: &quot;matchCSRF&quot;
    },
    &quot;Statement&quot;: {
        &quot;AndStatement&quot;: {
            &quot;Statements&quot;: [{
                    &quot;NotStatement&quot;: {
                        &quot;Statement&quot;: {
                            &quot;RegexPatternSetReferenceStatement&quot;: {
                                &quot;ARN&quot;: &quot;arn:aws:wafv2:YOUR_REGION:ACCOUNT_ID:regional/regexpatternset/csrf/YOUR_REGEX_PATTERN_ID&quot;,
                                &quot;FieldToMatch&quot;: {
                                    &quot;SingleHeader&quot;: {
                                        &quot;Name&quot;: &quot;x-csrf-token&quot;
                                    }
                                },
                                &quot;TextTransformations&quot;: [{
                                    &quot;Priority&quot;: 0,
                                    &quot;Type&quot;: &quot;URL_DECODE&quot;
                                }]
                            }
                        }
                    }
                },
                {
                    &quot;OrStatement&quot;: {
                        &quot;Statements&quot;: [{
                                &quot;ByteMatchStatement&quot;: {
                                    &quot;SearchString&quot;: &quot;/form.php&quot;,
                                    &quot;FieldToMatch&quot;: {
                                        &quot;UriPath&quot;: {}
                                    },
                                    &quot;TextTransformations&quot;: [{
                                        &quot;Priority&quot;: 0,
                                        &quot;Type&quot;: &quot;NONE&quot;
                                    }],
                                    &quot;PositionalConstraint&quot;: &quot;STARTS_WITH&quot;
                                }
                            },
                            {
                                &quot;ByteMatchStatement&quot;: {
                                    &quot;SearchString&quot;: &quot;/form.php&quot;,
                                    &quot;FieldToMatch&quot;: {
                                        &quot;UriPath&quot;: {}
                                    },
                                    &quot;TextTransformations&quot;: [{
                                        &quot;Priority&quot;: 0,
                                        &quot;Type&quot;: &quot;NONE&quot;
                                    }],
                                    &quot;PositionalConstraint&quot;: &quot;EXACTLY&quot;
                                }
                            }
                        ]
                    }
                }
            ]
        }
    }
}
</pre></div>


<p></p>
</details></p>
</li>
<li>
<p>Click <strong>Save rule</strong></p>
</li>
<li>Re-run the WAF test script (runscanner) from your red team host to confirm requests are blocked</li>
</ol>
</details>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p><p style="font-size:14px;">
  <strong>If you have 30 minutes or less remaining in the workshop, you should consider proceeding to the <a href="/workshop/host-layer/assess/">Host Layer round</a>.</strong> There will be time during the Inspector Assessment run to continue the WAF excercises.
</p></p>
</div>
<div class="admonition info">
<p class="admonition-title">Note About Remaining Exercises</p>
<p><strong>The remaining exercises below are optional. You should proceed to the <a href="../verify/">Verify Phase</a> and come back to the content below if time permits.</strong></p>
</div>
<hr />
<h3 id="4-limit-attack-footprint-optional">4. Limit Attack Footprint (Optional)</h3>
<p>Use geo matching to build rules that limit the attack footprint against the exposed components of your application.</p>
<p>Consider the following:
•   Does your web application have server-side include components in the public web path?</p>
<p>•   Does your web application have components at exposed paths that are not used (or dependencies have such functions)?</p>
<p>•   Do you have administrative, management, status or health check paths and components that aren’t meant for end user access?</p>
<p>You should consider blocking access to such elements, or limiting access to known sources, either whitelisted IP addresses or geographic locations.</p>
<details class="info"><summary>Solution</summary><ol>
<li>
<p>Create a new rule and choose <strong>Rule JSON editor</strong></p>
<ol>
<li>Paste the following JSON and update the region and Regex pattern ID with the one created in the previous step</li>
</ol>
<p><details><summary>Nested Statement with Limit Attack Footprint Solution</summary>
<p></p>
<div class="codehilite"><pre><span></span>{
    &quot;Name&quot;: &quot;matchAdminNotAffiliate&quot;,
    &quot;Priority&quot;: 4,
    &quot;Action&quot;: {
        &quot;Block&quot;: {}
    },
    &quot;VisibilityConfig&quot;: {
        &quot;SampledRequestsEnabled&quot;: true,
        &quot;CloudWatchMetricsEnabled&quot;: true,
        &quot;MetricName&quot;: &quot;matchAdminNotAffiliate&quot;
    },
    &quot;Statement&quot;: {
        &quot;AndStatement&quot;: {
            &quot;Statements&quot;: [{
                    &quot;NotStatement&quot;: {
                        &quot;Statement&quot;: {
                            &quot;GeoMatchStatement&quot;: {
                                &quot;CountryCodes&quot;: [
                                    &quot;US&quot;,
                                    &quot;RO&quot;
                                ]
                            }
                        }
                    }
                },
                {
                    &quot;ByteMatchStatement&quot;: {
                        &quot;FieldToMatch&quot;: {
                            &quot;UriPath&quot;: {}
                        },
                        &quot;PositionalConstraint&quot;: &quot;STARTS_WITH&quot;,
                        &quot;SearchString&quot;: &quot;/admin&quot;,
                        &quot;TextTransformations&quot;: [{
                            &quot;Type&quot;: &quot;NONE&quot;,
                            &quot;Priority&quot;: 0
                        }]
                    }
                }
            ]
        }
    }
}
</pre></div>


<p></p>
</details></p>
</li>
<li>
<p>Click on <strong>Add Rule</strong> and then click <strong>Save</strong></p>
</li>
</ol>
</details>
<h3 id="5-detect-mitigate-anomalies-optional">5. Detect &amp; Mitigate Anomalies (Optional)</h3>
<p>What constitutes an anomaly in regards to your web application? A few common anomaly patterns are:</p>
<ul>
<li>Unusually elevated volume of requests in general</li>
<li>Unusually elevated volumes of requests to specific URI paths</li>
<li>Unusually elevated levels of requests generating specific non-HTTP status 200 responses</li>
<li>Unusually elevated volumes from certain sources (IPs, geographies)</li>
<li>Usual request signatures (referrers, user agent strings, content types, etc)</li>
</ul>
<p>Do you have mechanisms in place to detect such patterns? If so, can you build rules to mitigate them?</p>
<details class="info"><summary>Solution</summary><ol>
<li>Create a new rule named <strong>matchRateLogin</strong> of type <strong>Rate-based rule</strong><ol>
<li><strong>Rate limit</strong> 1000</li>
<li>choose <strong>Only consider requests that match the criteria in a rule statement</strong></li>
<li>choose <strong>If a request</strong> choose <strong>matches at least one of the statements (OR)</strong>. Add statements:<ol>
<li>uri_path, starts with string, <em>/login.php</em></li>
<li>http_method, exactly matches string, <em>POST</em></li>
<li>text transformation, <em>None</em></li>
</ol>
</li>
<li>Click on <strong>Add Rule</strong> and then click <strong>Save</strong></li>
</ol>
</li>
</ol>
</details>
<h3 id="6-reputation-lists-nuisance-requests-optional">6. Reputation Lists, Nuisance Requests (Optional)</h3>
<p>Reputation lists (whitelists or blacklists) are a good way to filter and stop servicing low value requests. This can reduce operating costs, and reduce exposure to attack vectors. Reputation lists can be self-maintained: lists of identifiable actors that you have determined are undesired. They can be identified any number of ways:</p>
<ul>
<li>the source IP address</li>
<li>the user agent string</li>
<li>reuse of hijacked authorization or session tokens,</li>
<li>attempting to make requests to paths that clearly do not exist in your application but are well known vulnerable software packages (probing)</li>
</ul>
<p>Build blacklists of such actors using the relevant statements and set up rules to match and block them. An example IP-based blacklist already exists in your sandbox environment.</p>
<p>Reputation lists can also be maintained by third parties. The AWS WAF Security Automations allow you to implement IP-based reputation lists.</p>
<details class="info"><summary>Solution</summary><ol>
<li>edit the <strong>IP set</strong> <strong>SampleIPSetV4</strong><ol>
<li>add a test IP address <em>You can obtain your current IP at <a href="https://ifconfig.co/" target="_blank">Ifconfig.co</a> The entry should follow CIDR notation. i.e. 10.10.10.10/32 for a single host.</em></li>
</ol>
</li>
<li>Create a new rule named <strong>matchRepNuisance</strong><ol>
<li>uri_path, starts with, no transform, <em>/phpmyadmin</em></li>
</ol>
</li>
<li>Use the concepts you learned in the previous exercises to add the <em>filterNoPath</em> statement to your Web ACL.</li>
</ol>
</details>
<hr />
<p>You can now proceed to the <a href="../verify/">Verify Phase</a>.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../assess/" title="Assess Phase" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Assess Phase
              </span>
            </div>
          </a>
        
        
          <a href="../verify/" title="Verify Phase" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Verify Phase
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="http://protecting-workloads.awssecworkshops.com/" class="md-footer-social__link fa fa-home"></a>
    
      <a href="https://aws.amazon.com/security/" class="md-footer-social__link fa fa-shield"></a>
    
      <a href="https://twitter.com/awssecurityinfo?lang=en" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://aws.amazon.com/blogs/security/" class="md-footer-social__link fa fa-rss"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.39abc4af.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="../../../javascripts/extra.js"></script>
      
    
  </body>
</html>